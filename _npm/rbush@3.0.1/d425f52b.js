/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/rbush@3.0.1/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import t from"../quickselect@2.0.0/551b5bfb.js";class i{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(t){let i=this.data;const n=[];if(!u(t,i))return n;const e=this.toBBox,h=[];for(;i;){for(let r=0;r<i.children.length;r++){const s=i.children[r],a=i.leaf?e(s):s;u(t,a)&&(i.leaf?n.push(s):m(t,a)?this._all(s,n):h.push(s))}i=h.pop()}return n}collides(t){let i=this.data;if(!u(t,i))return!1;const n=[];for(;i;){for(let e=0;e<i.children.length;e++){const h=i.children[e],r=i.leaf?this.toBBox(h):h;if(u(t,r)){if(i.leaf||m(t,r))return!0;n.push(h)}}i=n.pop()}return!1}load(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(let i=0;i<t.length;i++)this.insert(t[i]);return this}let i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){const t=this.data;this.data=i,i=t}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=f([]),this}remove(t,i){if(!t)return this;let e=this.data;const h=this.toBBox(t),r=[],s=[];let a,l,o;for(;e||r.length;){if(e||(e=r.pop(),l=r[r.length-1],a=s.pop(),o=!0),e.leaf){const h=n(t,e.children,i);if(-1!==h)return e.children.splice(h,1),r.push(e),this._condense(r),this}o||e.leaf||!m(e,h)?l?(a++,e=l.children[a],o=!1):e=null:(r.push(e),s.push(a),a=0,l=e,e=e.children[0])}return this}toBBox(t){return t}compareMinX(t,i){return t.minX-i.minX}compareMinY(t,i){return t.minY-i.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,i){const n=[];for(;t;)t.leaf?i.push(...t.children):n.push(...t.children),t=n.pop();return i}_build(t,i,n,h){const r=n-i+1;let s,a=this._maxEntries;if(r<=a)return s=f(t.slice(i,n+1)),e(s,this.toBBox),s;h||(h=Math.ceil(Math.log(r)/Math.log(a)),a=Math.ceil(r/Math.pow(a,h-1))),s=f([]),s.leaf=!1,s.height=h;const l=Math.ceil(r/a),o=l*Math.ceil(Math.sqrt(a));x(t,i,n,o,this.compareMinX);for(let e=i;e<=n;e+=o){const i=Math.min(e+o-1,n);x(t,e,i,l,this.compareMinY);for(let n=e;n<=i;n+=l){const e=Math.min(n+l-1,i);s.children.push(this._build(t,n,e,h-1))}}return e(s,this.toBBox),s}_chooseSubtree(t,i,n,e){for(;e.push(i),!i.leaf&&e.length-1!==n;){let n,e=1/0,s=1/0;for(let a=0;a<i.children.length;a++){const o=i.children[a],c=l(o),m=(h=t,r=o,(Math.max(r.maxX,h.maxX)-Math.min(r.minX,h.minX))*(Math.max(r.maxY,h.maxY)-Math.min(r.minY,h.minY))-c);m<s?(s=m,e=c<e?c:e,n=o):m===s&&c<e&&(e=c,n=o)}i=n||i.children[0]}var h,r;return i}_insert(t,i,n){const e=n?t:this.toBBox(t),h=[],s=this._chooseSubtree(e,this.data,i,h);for(s.children.push(t),r(s,e);i>=0&&h[i].children.length>this._maxEntries;)this._split(h,i),i--;this._adjustParentBBoxes(e,h,i)}_split(t,i){const n=t[i],h=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,h);const s=this._chooseSplitIndex(n,r,h),a=f(n.children.splice(s,n.children.length-s));a.height=n.height,a.leaf=n.leaf,e(n,this.toBBox),e(a,this.toBBox),i?t[i-1].children.push(a):this._splitRoot(n,a)}_splitRoot(t,i){this.data=f([t,i]),this.data.height=t.height+1,this.data.leaf=!1,e(this.data,this.toBBox)}_chooseSplitIndex(t,i,n){let e,r=1/0,s=1/0;for(let a=i;a<=n-i;a++){const i=h(t,0,a,this.toBBox),o=h(t,a,n,this.toBBox),m=c(i,o),u=l(i)+l(o);m<r?(r=m,e=a,s=u<s?u:s):m===r&&u<s&&(s=u,e=a)}return e||n-i}_chooseSplitAxis(t,i,n){const e=t.leaf?this.compareMinX:s,h=t.leaf?this.compareMinY:a;this._allDistMargin(t,i,n,e)<this._allDistMargin(t,i,n,h)&&t.children.sort(e)}_allDistMargin(t,i,n,e){t.children.sort(e);const s=this.toBBox,a=h(t,0,i,s),l=h(t,n-i,n,s);let c=o(a)+o(l);for(let e=i;e<n-i;e++){const i=t.children[e];r(a,t.leaf?s(i):i),c+=o(a)}for(let e=n-i-1;e>=i;e--){const i=t.children[e];r(l,t.leaf?s(i):i),c+=o(l)}return c}_adjustParentBBoxes(t,i,n){for(let e=n;e>=0;e--)r(i[e],t)}_condense(t){for(let i,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(i=t[n-1].children,i.splice(i.indexOf(t[n]),1)):this.clear():e(t[n],this.toBBox)}}function n(t,i,n){if(!n)return i.indexOf(t);for(let e=0;e<i.length;e++)if(n(t,i[e]))return e;return-1}function e(t,i){h(t,0,t.children.length,i,t)}function h(t,i,n,e,h){h||(h=f(null)),h.minX=1/0,h.minY=1/0,h.maxX=-1/0,h.maxY=-1/0;for(let s=i;s<n;s++){const i=t.children[s];r(h,t.leaf?e(i):i)}return h}function r(t,i){return t.minX=Math.min(t.minX,i.minX),t.minY=Math.min(t.minY,i.minY),t.maxX=Math.max(t.maxX,i.maxX),t.maxY=Math.max(t.maxY,i.maxY),t}function s(t,i){return t.minX-i.minX}function a(t,i){return t.minY-i.minY}function l(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function o(t){return t.maxX-t.minX+(t.maxY-t.minY)}function c(t,i){const n=Math.max(t.minX,i.minX),e=Math.max(t.minY,i.minY),h=Math.min(t.maxX,i.maxX),r=Math.min(t.maxY,i.maxY);return Math.max(0,h-n)*Math.max(0,r-e)}function m(t,i){return t.minX<=i.minX&&t.minY<=i.minY&&i.maxX<=t.maxX&&i.maxY<=t.maxY}function u(t,i){return i.minX<=t.maxX&&i.minY<=t.maxY&&i.maxX>=t.minX&&i.maxY>=t.minY}function f(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function x(i,n,e,h,r){const s=[n,e];for(;s.length;){if((e=s.pop())-(n=s.pop())<=h)continue;const a=n+Math.ceil((e-n)/h/2)*h;t(i,a,n,e,r),s.push(n,a,a,e)}}export{i as default};
